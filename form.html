<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loan Application Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom font and spacing for the layout */
    body {
      font-family: 'Poppins', sans-serif;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    .button {
      background-color: #2f855a;
      padding: 14px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      border-radius: 5px;
      width: 100%;
      text-align: center;
      cursor: pointer;
    }

    .input-field, .select-field, .textarea {
      background-color: #2d3748;
      color: #cbd5e0;
      padding: 12px;
      border-radius: 8px;
      width: 100%;
      margin-bottom: 15px;
    }

    .input-field:focus, .select-field:focus, .textarea:focus {
      border: 2px solid #38a169;
      outline: none;
    }

    h2 {
      font-size: 24px;
      color: #38a169;
      text-align: center;
      margin-bottom: 20px;
    }

    .loader {
      display: none;
      text-align: center;
      margin-top: 10px;
    }

    .loader span {
      display: block;
      color: #38a169;
    }

    .loader div {
      border: 4px solid #f0f0f0;
      border-top: 4px solid #38a169;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      margin: 20px auto;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .result {
      color: #38a169;
      font-weight: bold;
      margin-top: 20px;
      padding: 10px;
      background-color: #2d3748;
      border-radius: 8px;
    }
  </style>
</head>
<body class="bg-gray-900 text-white font-sans">

  <div class="container p-6">
    <h2>Loan Application Form</h2>
    <form id="loanForm">
      <input type="text" id="name" placeholder="Full Name" class="input-field" required>
      <input type="text" id="phone" placeholder="Phone Number" class="input-field" required>
      <input type="text" id="id_number" placeholder="ID Number" class="input-field" required>
      <input type="email" id="email" placeholder="Email Address" class="input-field" required>
      <input type="number" id="loan_amount" placeholder="Loan Amount (KES)" class="input-field" required>

      <select id="loan_type" class="select-field" required>
        <option value="">Select Loan Type</option>
        <option value="personal">Personal Loan</option>
        <option value="emergency">Emergency Loan</option>
        <option value="business">Business Loan</option>
      </select>

      <select id="duration" class="select-field" required>
        <option value="">Select Duration</option>
        <option value="7">7 Days</option>
        <option value="14">14 Days</option>
      </select>

      <textarea id="message" placeholder="Your Message (Optional)" class="textarea"></textarea>

      <button id="submitBtn" type="submit" class="button">
        Submit Application
      </button>

      <div id="loadingIndicator" class="loader">
        <span>Submitting...</span>
        <div></div>
      </div>

      <div id="interestResult" class="result"></div>
    </form>
  </div>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    (function() {
      emailjs.init("0ockMZ07aVnggqzsD");
    })();

    document.getElementById("loanForm").addEventListener("submit", function(event) {
      event.preventDefault();

      // Custom Validation for Loan Amount
      const loanAmount = document.getElementById("loan_amount").value;
      if (loanAmount <= 0 || isNaN(loanAmount)) {
        alert("Please enter a valid loan amount greater than 0.");
        return;
      }

      // Show Loading Indicator
      document.getElementById("submitBtn").disabled = true;
      document.getElementById("loadingIndicator").style.display = "block";

      // Calculate Interest and Late Fee
      const amount = parseFloat(loanAmount);
      const duration = parseInt(document.getElementById("duration").value);
      const loanType = document.getElementById("loan_type").value;
      let interest = 0;
      let lateFee = 0;
      let totalRepayment = 0;

      if (loanType === "personal") {
        if (duration === 7) {
          interest = amount * 0.15; // 15% for 7 days
          totalRepayment = amount + interest;
        } else if (duration === 14) {
          interest = amount * 0.30; // 30% for 14 days
          totalRepayment = amount + interest;
        }
      } else if (loanType === "emergency") {
        if (duration === 7) {
          interest = amount * 0.20; // 20% for 7 days
          totalRepayment = amount + interest;
        } else if (duration === 14) {
          interest = amount * 0.40; // 40% for 14 days
          totalRepayment = amount + interest;
        }
      } else if (loanType === "business") {
        if (duration === 7) {
          interest = amount * 0.25; // 25% for 7 days
          totalRepayment = amount + interest;
        } else if (duration === 14) {
          interest = amount * 0.50; // 50% for 14 days
          totalRepayment = amount + interest;
        }
      }

      if (duration > 7) lateFee = 20; // Late Fee after 7 days

      const totalWithLateFee = totalRepayment + lateFee;
      const resultText = `
        Loan Type: ${loanType.charAt(0).toUpperCase() + loanType.slice(1)} Loan
        Loan Amount: KES ${amount}
        Interest for ${duration} Days: KES ${interest.toFixed(2)}
        Total (Without Late Fee): KES ${totalRepayment.toFixed(2)}
        ${lateFee > 0 ? `Late Fee (Added after 7 days): KES ${lateFee}` : ''}
        Total (With Late Fee): KES ${totalWithLateFee.toFixed(2)}
      `;

      // Show result
      document.getElementById('interestResult').textContent = resultText;

      // Send the loan application data via email
      emailjs.send("service_g5v9kbm", "template_i72ecc5", {
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        id_number: document.getElementById("id_number").value,
        email: document.getElementById("email").value,
        loan_amount: document.getElementById("loan_amount").value,
        loan_type: loanType,
        duration: document.getElementById("duration").value,
        message: document.getElementById("message").value,
      }).then(function(response) {
        console.log("SUCCESS!", response.status, response.text);
        window.location.href = "thank_you.html";
      }, function(error) {
        console.log("FAILED...", error);
        alert("Failed to send application. Please try again.");
        document.getElementById("submitBtn").disabled = false;
        document.getElementById("loadingIndicator").style.display = "none";
      });
    });

    // Interest Calculator (Updated)
    const loanInput = document.getElementById('loan_amount');
    const durationInput = document.getElementById('duration');
    const loanTypeInput = document.getElementById('loan_type');
    const resultDiv = document.getElementById('interestResult');

    function calculateInterest() {
      const amount = parseFloat(loanInput.value);
      const days = parseInt(durationInput.value);
      const loanType = loanTypeInput.value;
      let interest = 0;
      let lateFee = 0;
      let totalRepayment = 0;

      if (loanType === "personal") {
        if (days === 7) {
          interest = amount * 0.15; // 15% for 7 days
          totalRepayment = amount + interest;
        } else if (days === 14) {
          interest = amount * 0.30; // 30% for 14 days
          totalRepayment = amount + interest;
        }
      } else if (loanType === "emergency") {
        if (days === 7) {
          interest = amount * 0.20; // 20% for 7 days
          totalRepayment = amount + interest;
        } else if (days === 14) {
          interest = amount * 0.40; // 40% for 14 days
          totalRepayment = amount + interest;
        }
      } else if (loanType === "business") {
        if (days === 7) {
          interest = amount * 0.25; // 25% for 7 days
          totalRepayment = amount + interest;
        } else if (days === 14) {
          interest = amount * 0.50; // 50% for 14 days
          totalRepayment = amount + interest;
        }
      }

      if (days > 7) lateFee = 20; // Late Fee after 7 days

      const totalWithLateFee = totalRepayment + lateFee;

      resultDiv.textContent = `
        Loan Type: ${loanType.charAt(0).toUpperCase() + loanType.slice(1)} Loan
        Loan Amount: KES ${amount}
        Interest for ${days} Days: KES ${interest.toFixed(2)}
        Total (Without Late Fee): KES ${totalRepayment.toFixed(2)}
        ${lateFee > 0 ? `Late Fee (Added after 7 days): KES ${lateFee}` : ''}
        Total (With Late Fee): KES ${totalWithLateFee.toFixed(2)}
      `;
    }

    loanInput.addEventListener('input', calculateInterest);
    durationInput.addEventListener('change', calculateInterest);
    loanTypeInput.addEventListener('change', calculateInterest);
  </script>
</body>
</html>
